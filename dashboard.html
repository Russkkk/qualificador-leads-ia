<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Avan√ßado</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
    }
    h1 { margin-bottom: 10px; }

    input, select, button {
      padding: 8px;
      border-radius: 6px;
      border: none;
      margin-right: 10px;
    }

    button {
      cursor: pointer;
      background: #2563eb;
      color: white;
    }

    .cards {
      display: flex;
      gap: 20px;
      margin: 20px 0;
    }

    .card {
      background: #020617;
      padding: 20px;
      border-radius: 10px;
      width: 200px;
      text-align: center;
    }

    canvas {
      background: #020617;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #020617;
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #1e293b;
      text-align: center;
    }

    th {
      background: #020617;
      font-weight: bold;
    }

    tr:hover {
      background: #1e293b;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h1>üìä Dashboard Avan√ßado</h1>

<div>
  <input id="clientId" placeholder="client_id" />
  <select id="filtro">
    <option value="todos">Todos</option>
    <option value="quentes">Quentes</option>
    <option value="frios">Frios</option>
  </select>
  <button onclick="carregar()">Carregar</button>
</div>

<div class="cards">
  <div class="card">
    <h2 id="total">0</h2>
    <p>Total</p>
  </div>
  <div class="card">
    <h2 id="quentes">0</h2>
    <p>Quentes</p>
  </div>
  <div class="card">
    <h2 id="frios">0</h2>
    <p>Frios</p>
  </div>
</div>

<canvas id="grafico"></canvas>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Tempo</th>
      <th>P√°ginas</th>
      <th>Clicou Pre√ßo</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="tabela"></tbody>
</table>

<script>
let chart = null;
let leads = [];

function carregar() {
  const clientId = document.getElementById("clientId").value;
  const filtro = document.getElementById("filtro").value;

  fetch(`https://qualificador-leads-i-a.onrender.com/dashboard_data?client_id=${clientId}`)
    .then(res => res.json())
    .then(data => {
      leads = data.dados;

      document.getElementById("total").innerText = data.total_leads;
      document.getElementById("quentes").innerText = data.leads_quentes;
      document.getElementById("frios").innerText = data.leads_frios;

      atualizarTabela(filtro);
      atualizarGrafico(data.leads_quentes, data.leads_frios);
    })
    .catch(() => alert("Erro ao carregar dados"));
}

function atualizarTabela(filtro) {
  const tbody = document.getElementById("tabela");
  tbody.innerHTML = "";

  let filtrados = leads;

  if (filtro === "quentes") {
    filtrados = leads.filter(l => l.virou_cliente === 1);
  }

  if (filtro === "frios") {
    filtrados = leads.filter(l => l.virou_cliente === 0);
  }

  filtrados.forEach(l => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${l.id}</td>
      <td>${l.tempo_site}</td>
      <td>${l.paginas_visitadas}</td>
      <td>${l.clicou_preco ? "Sim" : "N√£o"}</td>
      <td>${l.virou_cliente === 1 ? \"üî• Quente\" : (l.virou_cliente === 0 ? \"‚ùÑÔ∏è Frio\" : \"‚è≥ Pendente\")}</td>
    `;

    tr.onclick = () => {
      alert(
        "Lead #" + l.id +
        "\nTempo no site: " + l.tempo_site +
        "\nP√°ginas: " + l.paginas_visitadas +
        "\nClicou pre√ßo: " + (l.clicou_preco ? "Sim" : "N√£o")
      );
    };

    tbody.appendChild(tr);
  });
}

function atualizarGrafico(quentes, frios) {
  const ctx = document.getElementById("grafico");

  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["Quentes", "Frios"],
      datasets: [{
        label: "Leads",
        data: [quentes, frios],
        backgroundColor: ["#22c55e", "#ef4444"]
      }]
    }
  });
}

document.getElementById("filtro").onchange = () => {
  atualizarTabela(document.getElementById("filtro").value);
};
</script>

</body>
</html>
