<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LeadRank ‚Ä¢ Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="page" id="appRoot">
    <header class="site-header">
      <a class="brand" href="landing.html">
        <span class="brand__logo">LR</span>
        <span class="brand__text">LeadRank</span>
      </a>
      <nav class="site-nav">
        <a href="landing.html">In√≠cio</a>
        <a href="pricing.html">Planos</a>
        <a href="onboarding.html">Criar conta</a>
        <a href="login.html">Entrar</a>
      </nav>
      <a class="btn btn--ghost" href="onboarding.html?mode=login">Trocar conta</a>
    </header>

    <main>
      <section class="dashboard">
        <div class="card daily-hero">
          <div class="daily-hero__header">
            <div>
              <p class="eyebrow">Resumo do dia</p>
              <h1 class="daily-hero__title">üî• A√ß√£o do dia</h1>
              <p class="subtitle">Esses s√£o os leads com maior chance de fechar agora.</p>
            </div>
          </div>

          <div class="daily-hero__grid">
            <div class="daily-card daily-card--hot">
              <div class="daily-card__top">
                <span class="daily-card__icon">üî•</span>
                <div>
                  <p class="daily-card__label">Quentes</p>
                  <p class="daily-card__value" id="dailyHotCount">‚Äî</p>
                </div>
              </div>
              <p class="text-muted">Ligue primeiro</p>
              <button class="btn btn--small" type="button" data-jump-filter="hot">Ver quentes</button>
            </div>

            <div class="daily-card daily-card--warm">
              <div class="daily-card__top">
                <span class="daily-card__icon">üü°</span>
                <div>
                  <p class="daily-card__label">Mornos</p>
                  <p class="daily-card__value" id="dailyWarmCount">‚Äî</p>
                </div>
              </div>
              <p class="text-muted">Acompanhe hoje</p>
              <button class="btn btn--small btn--ghost" type="button" data-jump-filter="warm">Ver mornos</button>
            </div>

            <div class="daily-card daily-card--cold">
              <div class="daily-card__top">
                <span class="daily-card__icon">‚ùÑÔ∏è</span>
                <div>
                  <p class="daily-card__label">Frios</p>
                  <p class="daily-card__value" id="dailyColdCount">‚Äî</p>
                </div>
              </div>
              <p class="text-muted">Nutrir / automa√ß√£o</p>
              <button class="btn btn--small btn--ghost" type="button" data-jump-filter="cold">Ver frios</button>
            </div>

            <div class="daily-card daily-card--success">
              <div class="daily-card__top">
                <span class="daily-card__icon">‚úÖ</span>
                <div>
                  <p class="daily-card__label">Convertidos hoje</p>
                  <p class="daily-card__value" id="dailyConvertedCount">‚Äî</p>
                </div>
              </div>
              <p class="text-muted">Feedback do time</p>
              <button class="btn btn--tiny btn--ghost" type="button" data-jump-filter="convertido">Ver convertidos</button>
            </div>
          </div>
        </div>

        <div class="dashboard__header">
          <div>
            <p class="eyebrow">Dashboard</p>
            <h1 class="dashboard__title">Vis√£o geral do funil</h1>
            <p class="subtitle">Acompanhe o desempenho dos leads e ajuste prioridades rapidamente.</p>
          </div>
          <div class="pill pill--muted" id="wsPill">workspace: ‚Äî</div>
        </div>

        <div class="dashboard__grid">
          <div class="card">
            <h2>Indicadores principais</h2>
            <div class="dashboard__kpis">
              <div class="kpi">
                <div class="text-muted">Convertidos</div>
                <div class="kpi__value" id="kpiConv">‚Äî</div>
              </div>
              <div class="kpi">
                <div class="text-muted">Negados</div>
                <div class="kpi__value" id="kpiNeg">‚Äî</div>
              </div>
              <div class="kpi">
                <div class="text-muted">Pendentes</div>
                <div class="kpi__value" id="kpiPend">‚Äî</div>
              </div>
            </div>

            <div class="alert" id="msg" style="display:none"></div>

            <div class="dashboard__charts">
              <div class="card card--soft">
                <h3>Temperatura dos leads</h3>
                <p class="text-muted">Quentes, mornos, frios e pendentes.</p>
                <div class="dashboard__chart"><canvas id="funnelChart"></canvas></div>
              </div>
              <div class="card card--soft">
                <h3>Status do pipeline</h3>
                <p class="text-muted">Convertidos, negados e pendentes.</p>
                <div class="dashboard__chart"><canvas id="statusChart"></canvas></div>
              </div>
            </div>

            <div class="card card--soft" style="margin-top:16px">
              <h3>Resumo</h3>
              <div class="text-muted" id="summaryWrap">Carregue o dashboard para ver.</div>
            </div>
          </div>

          <div class="card">
            <h2>Conex√£o</h2>
            <form class="form" onsubmit="return false;">
              <label for="clientId">
                client_id
                <input id="clientId" name="clientId" placeholder="trial-..." autocomplete="off" />
              </label>
              <label for="apiKey">
                api_key
                <input id="apiKey" name="apiKey" placeholder="sk_live_..." autocomplete="off" />
              </label>
              <div class="button-group">
                <button class="btn btn--small" type="button" id="btnSave">Salvar</button>
                <button class="btn btn--ghost btn--small" type="button" id="btnLoad">Carregar dashboard</button>
                <button class="btn btn--ghost btn--small" type="button" id="btnExport" data-export>Exportar CSV</button>
              </div>
              <p class="form__hint">
                A API Key √© usada no header <code>X-API-KEY</code>.
              </p>
            </form>

            <div class="card card--soft" style="margin-top:16px">
              <h3>Teste r√°pido</h3>
              <p class="text-muted">Envie um lead e veja o score calculado.</p>
              <div class="button-group" style="margin-top:12px">
                <button class="btn btn--ghost btn--small" id="btnTest" type="button">Enviar 1 lead de teste</button>
                <button class="btn btn--small" id="btnSeed10" type="button">Gerar 10 leads de teste</button>
              </div>
              <p class="text-muted" style="margin-top:12px">Isso ajuda a IA calibrar melhor score e probabilidade.</p>
              <div class="alert" id="testMsg" style="display:none"></div>
            </div>

            <div class="card card--soft" style="margin-top:16px">
              <h3>Enviar lead real</h3>
              <p class="text-muted">Use esse formul√°rio para registrar leads reais do seu time.</p>
              <form class="form" id="realLeadForm">
                <label for="realNome">Nome
                  <input id="realNome" name="realNome" placeholder="Maria Oliveira" autocomplete="name" />
                </label>
                <label for="realEmail">Email
                  <input id="realEmail" name="realEmail" type="email" placeholder="maria@empresa.com" autocomplete="email" />
                </label>
                <label for="realTelefone">Telefone
                  <input id="realTelefone" name="realTelefone" placeholder="(11) 90000-0000" autocomplete="tel" />
                </label>
                <label for="realOrigem">Origem
                  <input id="realOrigem" name="realOrigem" placeholder="formulario-site" autocomplete="off" />
                </label>
                <label for="realTempo">Tempo no site (segundos)
                  <input id="realTempo" name="realTempo" type="number" min="0" placeholder="120" />
                </label>
                <label for="realPaginas">P√°ginas visitadas
                  <input id="realPaginas" name="realPaginas" type="number" min="0" placeholder="4" />
                </label>
                <label for="realPreco">Clicou em pre√ßo?
                  <select id="realPreco" name="realPreco">
                    <option value="0">N√£o</option>
                    <option value="1">Sim</option>
                  </select>
                </label>
                <button class="btn btn--block" type="submit">Registrar lead real</button>
              </form>
              <p class="form__hint">Dica: use o mesmo client_id e api_key para integrar o envio direto pelo seu CRM.</p>
              <div class="alert" id="realLeadMsg" style="display:none"></div>
            </div>
          </div>
        </div>

        <!-- ACTION LIST -->
        <div class="card action-list" id="actionList" data-state="empty">
          <div class="action-list__header">
            <h2>üìû Leads para agir agora</h2>
          </div>

          <div class="action-list__bar">
            <div class="chip-group" role="tablist" aria-label="Filtro r√°pido">
              <button class="chip chip--active" type="button" data-filter="hot">üî• Quentes</button>
              <button class="chip" type="button" data-filter="warm">üü° Mornos</button>
              <button class="chip" type="button" data-filter="cold">‚ùÑÔ∏è Frios</button>
              <button class="chip" type="button" data-filter="pendente">‚è≥ Pendentes</button>
              <button class="chip" type="button" data-filter="convertido">‚úÖ Convertidos</button>
              <button class="chip" type="button" data-filter="negado">‚ùå Negados</button>
            </div>

            <div class="action-list__controls">
              <label class="search">
                <span class="sr-only">Buscar por nome, telefone, origem</span>
                <input id="leadSearch" name="leadSearch" type="search" placeholder="Buscar por nome, telefone, origem" autocomplete="off" />
              </label>
              <button class="btn btn--ghost btn--small" type="button" id="btnExport2" data-export>Exportar CSV</button>
            </div>
          </div>

          <div class="action-list__body" id="actionBody">
            <div class="action-state action-state--loading">
              <div class="skeleton-grid">
                <div class="skeleton-card">
                  <div class="skeleton-line skeleton-line--lg"></div>
                  <div class="skeleton-line"></div>
                  <div class="skeleton-pill"></div>
                </div>
                <div class="skeleton-card">
                  <div class="skeleton-line skeleton-line--lg"></div>
                  <div class="skeleton-line"></div>
                  <div class="skeleton-pill"></div>
                </div>
              </div>
              <div class="skeleton-table">
                <div class="skeleton-line skeleton-line--md"></div>
                <div class="skeleton-line"></div>
                <div class="skeleton-line"></div>
              </div>
            </div>

            <div class="action-state action-state--empty">
              <p class="empty-state__title">Voc√™ ainda n√£o tem leads suficientes para priorizar.</p>
              <p class="text-muted">Comece gerando leads de teste ou conecte seu CRM para liberar a prioriza√ß√£o di√°ria.</p>
              <div class="action-list__cta">
                <button class="btn btn--small" type="button" data-seed10>Gerar 10 leads de teste</button>
                <a class="btn btn--ghost btn--small" href="onboarding.html#integracao" target="_blank" rel="noreferrer">Ver como integrar</a>
              </div>
            </div>

            <div class="action-state action-state--error">
              <p class="empty-state__title">N√£o conseguimos carregar seus leads. Confira sua conex√£o ou chave de integra√ß√£o.</p>
              <button class="btn btn--small" type="button" data-retry>Tentar novamente</button>
            </div>

            <div class="action-state action-state--ready">
              <div id="leadsList"></div>
              <div class="action-list__insights">
                <p>Leads quentes = maiores chances de fechar agora.</p>
                <p>Marque o resultado do contato. O LeadRank aprende com seu time.</p>
                <p>Quanto mais feedback, melhor a prioriza√ß√£o.</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <span>¬© 2024 LeadRank. Todos os direitos reservados.</span>
      <div class="footer__links">
        <a href="landing.html">In√≠cio</a>
        <a href="pricing.html">Planos</a>
        <a href="onboarding.html">Criar conta</a>
      </div>
    </footer>
  </div>

  <!-- MODAL -->
  <div class="modal" id="leadDetailsModal" aria-hidden="true">
    <div class="modal__backdrop" data-close-details></div>
    <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="leadDetailsTitle">
      <div class="modal__header">
        <div>
          <p class="eyebrow">Detalhes do lead</p>
          <h3 id="leadDetailsTitle">‚Äî</h3>
        </div>
        <button class="btn btn--ghost btn--small" type="button" data-close-details>Fechar</button>
      </div>

      <div class="modal__grid">
        <div>
          <p class="text-muted">Contato</p>
          <div class="modal__contact">
            <span id="leadDetailsPhone">‚Äî</span>
            <button class="btn btn--tiny btn--ghost" type="button" id="copyPhone">Copiar</button>
          </div>
        </div>
        <div>
          <p class="text-muted">Origem</p>
          <p class="modal__value" id="leadDetailsOrigin">‚Äî</p>
        </div>
        <div>
          <p class="text-muted">Tempo no site</p>
          <p class="modal__value" id="leadDetailsTime">‚Äî</p>
        </div>
        <div>
          <p class="text-muted">P√°ginas visitadas</p>
          <p class="modal__value" id="leadDetailsPages">‚Äî</p>
        </div>
        <div>
          <p class="text-muted">Clicou em pre√ßo</p>
          <p class="modal__value" id="leadDetailsPrice">‚Äî</p>
        </div>
        <div class="modal__score">
          <p class="text-muted">Score + Probabilidade</p>
          <p class="modal__value" id="leadDetailsScore">‚Äî</p>
          <p class="text-muted">Score considera inten√ß√£o e fit. Probabilidade estima chance de fechar.</p>
        </div>
      </div>

      <div class="modal__actions">
        <button class="btn btn--ghost btn--small" type="button" data-lead-action="convert" aria-label="Marcar como convertido">‚úÖ</button>
        <button class="btn btn--ghost btn--small" type="button" data-lead-action="deny" aria-label="Marcar como negado">‚ùå</button>
        <button class="btn btn--ghost btn--small" type="button" data-lead-action="later" aria-label="Marcar para depois">‚è≥</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // Backend base
    const BACKEND = (window.BACKEND_URL || "https://qualificador-leads-i-a.onrender.com").replace(/\/$/, "");

    // Query helper
    function qs(name) { return new URLSearchParams(location.search).get(name) || ""; }

    function getAuth() {
      return {
        client_id: qs("client_id") || localStorage.getItem("leadrank_client_id") || localStorage.getItem("client_id") || localStorage.getItem("LR_CLIENT_ID") || "",
        api_key: qs("api_key") || localStorage.getItem("leadrank_api_key") || localStorage.getItem("api_key") || localStorage.getItem("LR_API_KEY") || ""
      };
    }
    function setAuth(client_id, api_key) {
      localStorage.setItem("leadrank_client_id", client_id);
      localStorage.setItem("leadrank_api_key", api_key);
      localStorage.setItem("client_id", client_id);
      localStorage.setItem("api_key", api_key);
      localStorage.setItem("LR_CLIENT_ID", client_id);
      localStorage.setItem("LR_API_KEY", api_key);
      if (qs("client_id") || qs("api_key")) history.replaceState({}, "", "index.html");
    }

    window.__lr = {
      async lrApi(path, { method = "GET", body = null, headers = {} } = {}) {
        const { client_id, api_key } = getAuth();
        const url = new URL(BACKEND + path);
        if (client_id && method === "GET") url.searchParams.set("client_id", client_id);

        const h = { "Content-Type": "application/json", ...headers };
        if (api_key) h["X-API-KEY"] = api_key;

        const res = await fetch(url.toString(), {
          method,
          headers: h,
          body: body ? JSON.stringify(body) : null
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data.error || data.message || ("HTTP " + res.status));
        return data;
      }
    };
  </script>

  <script src="modal.js"></script>
  <script src="dashboard.js"></script>
</body>
</html>
