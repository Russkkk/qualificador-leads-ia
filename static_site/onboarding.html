<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LeadRank • Criar conta</title>
  <style>
    :root{
      --bg:#0a0e17; --card:#121826; --text:#e2e8f0; --muted:#94a3b8;
      --accent:#6366f1; --accent2:#22c55e; --border:#1e2937; --danger:#ef4444;
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif;
      background: radial-gradient(1200px 800px at 10% -10%, rgba(99,102,241,.35), transparent 55%),
                  radial-gradient(900px 600px at 100% 10%, rgba(34,197,94,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:28px;
    }
    .wrap{width:min(980px,100%); display:grid; grid-template-columns: 1.05fr .95fr; gap:22px;}
    @media (max-width: 860px){ .wrap{grid-template-columns:1fr;}}
    .hero{
      padding:28px; border:1px solid var(--border); border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
    }
    .badge{display:inline-flex; align-items:center; gap:10px; padding:8px 12px; border-radius:999px;
      background: rgba(99,102,241,.12); border:1px solid rgba(99,102,241,.25); color: #c7d2fe;
      font-weight:600; font-size:13px;}
    h1{margin:14px 0 10px; font-size:34px; line-height:1.1;}
    p{margin:0 0 10px; color:var(--muted); line-height:1.55;}
    .list{margin-top:16px; display:grid; gap:10px;}
    .li{display:flex; gap:10px; align-items:flex-start; color:var(--text);}
    .dot{width:10px;height:10px;border-radius:50%; background:rgba(34,197,94,.9); margin-top:6px; flex:0 0 10px;}
    .card{
      padding:22px; border:1px solid var(--border); border-radius: var(--radius);
      background: rgba(18,24,38,.85);
      box-shadow: var(--shadow);
    }
    .tabs{display:flex; gap:10px; margin-bottom:14px;}
    .tab{
      flex:1; padding:10px 12px; border-radius: 12px;
      border:1px solid var(--border); background: rgba(255,255,255,.03);
      color: var(--muted); font-weight:700; cursor:pointer;
    }
    .tab.active{ background: rgba(99,102,241,.18); border-color: rgba(99,102,241,.35); color: var(--text);}
    label{display:block; font-size:13px; color: var(--muted); margin:10px 0 6px;}
    input{
      width:100%; padding:12px 12px; border-radius: 12px;
      border: 1px solid var(--border); background: rgba(10,14,23,.55);
      color: var(--text); outline:none;
    }
    input:focus{border-color: rgba(99,102,241,.6); box-shadow: 0 0 0 4px rgba(99,102,241,.12);}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    @media (max-width:520px){.row{grid-template-columns:1fr}}
    .btn{
      width:100%; padding:12px 14px; margin-top:14px;
      border-radius: 12px; border: 0; cursor:pointer;
      background: var(--accent); color:white; font-weight:800;
    }
    .btn:hover{filter:brightness(1.06)}
    .btn.secondary{background: rgba(255,255,255,.08); border:1px solid var(--border); color: var(--text);}
    .note{font-size:12px; color: var(--muted); margin-top:10px;}
    .msg{margin-top:14px; padding:12px; border-radius: 12px; border:1px solid var(--border); background: rgba(255,255,255,.03); display:none;}
    .msg.ok{border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.08); display:block;}
    .msg.err{border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.08); display:block;}
    code{display:block; padding:10px; background: rgba(10,14,23,.6); border:1px solid var(--border); border-radius: 12px; overflow:auto;}
    .small{font-size:12px; color: var(--muted);}
    a{color:#c7d2fe}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="hero">
      <span class="badge">⚡ Trial de 14 dias • Setup em 2 minutos</span>
      <h1>Qualifique leads automaticamente e foque no que dá dinheiro.</h1>
      <p>O LeadRank calcula probabilidade de compra e organiza seus leads em quente/morno/frio — com dashboard e export para CRM.</p>
      <div class="list">
        <div class="li"><span class="dot"></span><div><b>Dashboard pronto</b><br><span class="small">KPIs, origens e leads quentes do dia</span></div></div>
        <div class="li"><span class="dot"></span><div><b>API Key do seu workspace</b><br><span class="small">Integre com formulário, WhatsApp, chatbot ou site</span></div></div>
        <div class="li"><span class="dot"></span><div><b>Escala com planos</b><br><span class="small">Controle de uso mensal e upgrade quando precisar</span></div></div>
      </div>
      <p class="note">Dica: use um email real pra não perder seu acesso. Você vai fazer login por email + senha.</p>
    </section>

    <section class="card">
      <div class="tabs">
        <button class="tab active" id="tabSignup" type="button">Criar conta</button>
        <button class="tab" id="tabLogin" type="button">Entrar</button>
      </div>

      <!-- Signup -->
      <form id="signupForm">
        <div class="row">
          <div>
            <label for="nome">Seu nome</label>
            <input id="nome" autocomplete="name" placeholder="Renato Ribeiro" />
          </div>
          <div>
            <label for="empresa">Empresa</label>
            <input id="empresa" autocomplete="organization" placeholder="Minha Empresa" />
          </div>
        </div>

        <label for="email">Email</label>
        <input id="email" type="email" autocomplete="email" placeholder="seuemail@empresa.com" required />

        <div class="row">
          <div>
            <label for="telefone">Telefone (opcional)</label>
            <input id="telefone" autocomplete="tel" placeholder="(11) 99999-9999" />
          </div>
          <div>
            <label for="password">Senha</label>
            <input id="password" type="password" autocomplete="new-password" placeholder="mín. 6 caracteres" required />
          </div>
        </div>

        <button class="btn" type="submit" id="btnSignup">Criar conta</button>
        <div class="note">Ao criar, você recebe <b>client_id</b> + <b>api_key</b> e já pode usar o dashboard.</div>
        <div class="msg" id="signupMsg"></div>
      </form>

      <!-- Login -->
      <form id="loginForm" style="display:none;">
        <label for="loginEmail">Email</label>
        <input id="loginEmail" type="email" autocomplete="email" placeholder="seuemail@empresa.com" required />

        <label for="loginPassword">Senha</label>
        <input id="loginPassword" type="password" autocomplete="current-password" placeholder="sua senha" required />

        <button class="btn" type="submit" id="btnLogin">Entrar</button>
        <button class="btn secondary" type="button" id="btnGoSignup">Quero criar conta</button>

        <div class="msg" id="loginMsg"></div>
      </form>
    </section>
  </div>

<script>
  const BACKEND = (window.BACKEND_URL || "https://qualificador-leads-i-a.onrender.com").replace(/\/$/, "");

  const tabSignup = document.getElementById("tabSignup");
  const tabLogin = document.getElementById("tabLogin");
  const signupForm = document.getElementById("signupForm");
  const loginForm = document.getElementById("loginForm");
  const signupMsg = document.getElementById("signupMsg");
  const loginMsg = document.getElementById("loginMsg");

  function showSignup(){
    tabSignup.classList.add("active"); tabLogin.classList.remove("active");
    signupForm.style.display = "block"; loginForm.style.display = "none";
    signupMsg.className = "msg"; signupMsg.style.display="none";
    loginMsg.className = "msg"; loginMsg.style.display="none";
  }
  function showLogin(prefillEmail=""){
    tabLogin.classList.add("active"); tabSignup.classList.remove("active");
    signupForm.style.display = "none"; loginForm.style.display = "block";
    if (prefillEmail) document.getElementById("loginEmail").value = prefillEmail;
    signupMsg.className = "msg"; signupMsg.style.display="none";
    loginMsg.className = "msg"; loginMsg.style.display="none";
  }
  tabSignup.onclick = showSignup;
  tabLogin.onclick = () => showLogin();

  document.getElementById("btnGoSignup").onclick = showSignup;

  function persistAuth(client_id, api_key){
    localStorage.setItem("leadrank_client_id", client_id);
    localStorage.setItem("leadrank_api_key", api_key);
  }

  function renderCreds(whereEl, data){
    whereEl.innerHTML = `
      ✅ <b>Pronto!</b><br><br>
      <div class="small">Guarde estes dados:</div>
      <div style="margin-top:10px"><b>client_id</b></div>
      <code>${data.client_id}</code>
      <div style="margin-top:10px"><b>api_key</b></div>
      <code>${data.api_key}</code>
      <div class="note">Você será redirecionado para o dashboard.</div>
    `;
  }

  async function postJSON(path, payload){
    const res = await fetch(BACKEND + path, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    const data = await res.json().catch(() => ({}));
    return {res, data};
  }

  signupForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    signupMsg.className = "msg"; signupMsg.style.display="none";

    const payload = {
      nome: document.getElementById("nome").value.trim(),
      empresa: document.getElementById("empresa").value.trim(),
      email: document.getElementById("email").value.trim().toLowerCase(),
      telefone: document.getElementById("telefone").value.trim(),
      password: document.getElementById("password").value
    };

    const {res, data} = await postJSON("/signup", payload);

    if (res.ok && (data.success || data.ok)) {
      persistAuth(data.client_id, data.api_key);
      signupMsg.className = "msg ok"; signupMsg.style.display="block";
      renderCreds(signupMsg, data);
      setTimeout(() => {
        window.location.href = `index.html?client_id=${encodeURIComponent(data.client_id)}&api_key=${encodeURIComponent(data.api_key)}`;
      }, 900);
      return;
    }

    // Email já existe -> direciona pro login
    if (res.status === 409 && (data.code === "email_exists" || (data.error||"").toLowerCase().includes("cadastrado"))) {
      signupMsg.className = "msg err"; signupMsg.style.display="block";
      signupMsg.innerHTML = `⚠️ ${data.error || "Email já cadastrado."}<br><br>Vamos entrar com sua senha.`;
      showLogin(payload.email);
      return;
    }

    signupMsg.className = "msg err"; signupMsg.style.display="block";
    signupMsg.textContent = "Erro: " + (data.error || data.message || "não foi possível criar a conta.");
  });

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    loginMsg.className = "msg"; loginMsg.style.display="none";

    const payload = {
      email: document.getElementById("loginEmail").value.trim().toLowerCase(),
      password: document.getElementById("loginPassword").value
    };

    const {res, data} = await postJSON("/login", payload);

    if (res.ok && (data.success || data.ok)) {
      persistAuth(data.client_id, data.api_key);
      loginMsg.className = "msg ok"; loginMsg.style.display="block";
      renderCreds(loginMsg, data);
      setTimeout(() => {
        window.location.href = `index.html?client_id=${encodeURIComponent(data.client_id)}&api_key=${encodeURIComponent(data.api_key)}`;
      }, 600);
      return;
    }

    loginMsg.className = "msg err"; loginMsg.style.display="block";
    loginMsg.textContent = "Erro: " + (data.error || data.message || "falha no login.");
  });

  // Se vier com ?mode=login, abre login
  const params = new URLSearchParams(location.search);
  if (params.get("mode") === "login") showLogin(params.get("email")||"");
</script>
</body>
</html>
